{% extends "basechat.html" %}
{% load static %}

{% block title %}
Chat
{% endblock %}

{% block chat %}
<div class="chat__chat">
  <div class="title_chat">
    <img
      class="title_chat_avatar"
      src="{{ user.avatar.avatar.url }}"
      alt="avatar"
    />
    <img
      class="title_chat_status"
      src="{% static 'img/Ellipse 3.png' %}"
    />
    <div class="title_chat_about_user">
      <span class="title_chat_nickname">{{user.username}}</span>
      <span class="title_chat_last_time">У мережі 5 хв тому</span>
    </div>
  </div>
  <div class="chat" id="chat">
    {% for message in messages %} 
    {% if message.sender == request.user.username %}
    
    {% if message.base64 == 1 %}
    <div class="right for_audio">
      <audio controls="controls" autobuffer="autobuffer" class="my_audio">
        <source src="data:audio/wav;base64, {{ message.message }}" />
      </audio> 
      <span class="time_message">{{ message.timestamp|date:"H:i" }}</span>
    </div>
    
    {% else%}
    <div class="chat_message right">
      <span class="chat_message-text">{{message.message}}</span>
      <span class="time_message">{{ message.timestamp|date:"H:i" }}</span>
    </div>
    {%endif%}
   
    {% else %}

    {% if message.base64 == 1 %}
    <div class="left ">
      <audio controls="controls" autobuffer="autobuffer" class="my_audio">
        <source src="data:audio/wav;base64, {{ message.message }}" />
      </audio> 
      <span class="time_message">{{ message.timestamp|date:"H:i" }}</span>
    </div>
    
    {% else%}
    <div class="chat_message">
      <img
        class="title_chat_avatar"
        src="{{ user.avatar.avatar.url }}"
        alt="avatar"
      />
      <span class="chat_message-text">{{message.message}}</span>
      <span class="time_message">{{ message.timestamp|date:"H:i" }}</span>
    </div>
    {%endif%}
    {% endif %}
    {% endfor %}

     <div data-role="recordings"></div>
  </div>
  <div class="input_message">
      <div data-role="controls">
      <button class="button_voise">
        <img
          src="{% static 'img/Vector3.svg' %}"
          onsubmit="myFunction()"
          alt="submit"
        />
      </button>
    </div>
      <input
        id="message_input"
        type="text"
        class="message_inp form-control"
      />
      <button id="chat-message-submit" class="button_send">
        <img src="{% static 'img/Vector1.svg' %}" alt="submit"  />
      </button>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{user.id|json_script:"json-username"}}
{{request.user.username|json_script:"json-message-username"}}
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript" src="https://markjivko.com/dist/recorder.js"></script>
<script type="text/javascript" src="{% static 'js/chat.js' %}"></script>
{% endblock %}

   

